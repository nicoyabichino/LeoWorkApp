<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Panel Profe - Control Total</title>
    
  <link rel="manifest" href="manifest-admin.json?v=9">
    <meta name="theme-color" content="#0b0f1a">
    
    <style>
        :root {
            --bg: #0b0f1a; --card: #161b22; --primary: #3b82f6;
            --success: #238636; --danger: #da3633; --text: #f0f6fc;
            --accent: #8b5cf6; 
            --electric-blue: #00d4ff; 
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 10px; padding-bottom: 50px; }
        h1 { font-size: 1.4rem; text-align: center; color: var(--primary); margin: 15px 0; }

        .card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #30363d; position: relative; }
        
        .sesion { border-top: 6px solid var(--accent); }
        .dia-label { position: absolute; top: -15px; left: 15px; background: var(--accent); color: white; padding: 2px 12px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; }

        label { display: block; font-size: 0.7rem; color: var(--primary); font-weight: bold; margin-bottom: 4px; text-transform: uppercase; }
        input, select { width: 100%; padding: 12px; margin-bottom: 10px; background: #0d1117; border: 1px solid #30363d; color: white; border-radius: 8px; font-size: 1rem; outline: none; }

        .btn-add-day { background: var(--accent); color: white; width: 100%; padding: 15px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin-bottom: 15px; }
        .btn-add-ex { background: #3e4c5a; color: #fff; border: none; padding: 12px; border-radius: 8px; cursor: pointer; width: 100%; font-size: 0.9rem; font-weight: bold; }
        .btn-gen { background: var(--primary); color: white; width: 100%; padding: 18px; font-size: 1.1rem; font-weight: bold; border: none; border-radius: 12px; cursor: pointer; margin-top: 10px; }

        .ex-item { border-left: 3px solid var(--primary); padding: 12px; margin-bottom: 12px; background: #1c2128; border-radius: 0 8px 8px 0; }
        .copy-area { background: #000; color: #22c55e; border: 1px solid var(--success); font-family: monospace; padding: 15px; border-radius: 8px; word-break: break-all; font-size: 0.75rem; margin-top: 10px; }
        
/* Estilo para el T√≠tulo Grande */
.title-sign { 
    text-align: center; 
    color: #888; 
    font-size: 1.4rem; /* Tama√±o grande para el t√≠tulo */
    letter-spacing: 3px; 
    margin-top: 40px; 
    font-weight: bold; 
}

/* Estilo para tu Firma Peque√±a */
.footer-sign { 
    text-align: center; 
    color: #444; 
    font-size: 0.8rem; /* Tama√±o original para tu marca */
    letter-spacing: 3px; 
    margin-top: 20px; 
    font-weight: bold; 
    padding-bottom: 100px; 
}

/* Reglas comunes para los enlaces y spans dentro de ambos */
.title-sign a, .footer-sign a {
    text-decoration: none;
}

.title-sign span, .footer-sign span { 
    color: #00d4ff;
    text-shadow: 0 0 8px rgba(0, 212, 255, 0.6);
    transition: 0.3s;
}

.title-sign span:hover, .footer-sign span:hover {
    text-shadow: 0 0 15px rgba(0, 212, 255, 1);
    color: #ffffff;
}

/* Efecto opcional al pasar el mouse o tocar */
.footer-sign span:hover {
    text-shadow: 0 0 15px rgba(0, 212, 255, 1);
    color: #ffffff;
}
        .brand-link { color: var(--electric-blue); text-decoration: none; }

        #temp-copy { position: absolute; left: -9999px; }
/* Ajuste para que el t√≠tulo no se corte en celulares */
@media (max-width: 400px) {
    .title-sign span {
        display: block; /* Fuerza el salto de l√≠nea solo en m√≥viles */
        margin-top: 5px;
    }
}
/* Protector de acceso */
#access-screen {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: var(--bg); z-index: 9999; display: flex;
    flex-direction: column; align-items: center; justify-content: center;
    padding: 20px;
}
    </style>
</head>
<body>
<div id="access-screen">
    <footer class="title-sign" style="margin-bottom: 20px;">
        PANEL PROFE <a><span>LEO RODRIGUEZ</span></a>
    </footer>
    <input type="password" id="admin-pass" placeholder="Ingrese Clave de Acceso" 
           style="max-width: 300px; text-align: center; border: 2px solid var(--primary);">
    <button onclick="verificarAcceso()" class="btn-gen" style="max-width: 300px;">ENTRAR AL PANEL</button>
    <p id="error-msg" style="color: var(--danger); font-size: 0.8rem; margin-top: 10px; display: none;">Clave incorrecta. Intente de nuevo.</p>
</div>

<footer class="title-sign">
    PANEL PROFE <a><span>LEO RODRIGUEZ</span></a>
</footer>

<div class="card">
        <label>Nombre del Alumno</label><input type="text" id="alumno-nombre" placeholder="Ej: Juan P√©rez">
        <label>Semana #</label><input type="text" id="semana-nro" placeholder="Ej: 1">
        <hr style="border: 0.5px solid #333; margin: 15px 0;">
        <button onclick="importarRutina()" style="background: transparent; color: var(--accent); border: 1px dashed var(--accent); width: 100%; padding: 10px; border-radius: 8px; font-size: 0.8rem; cursor: pointer;">
            üîÑ MODIFICAR RUTINA EXISTENTE (PEGAR C√ìDIGO)
        </button>
    </div>

    <div id="rutina-container"></div>

    <button class="btn-add-day" onclick="agregarSesion()">+ AGREGAR OTRO D√çA</button>
    <button class="btn-gen" onclick="generarLink()">GENERAR C√ìDIGO DE RUTINA</button>

 <div id="resultado" style="display:none;" class="card">
        <div style="text-align:center; padding: 10px 0;">
            <div style="font-size: 3rem; margin-bottom: 10px;">‚úÖ</div>
            <h2 style="color: var(--success); font-size: 1.2rem; margin-bottom: 5px;">¬°RUTINA LISTA!</h2>
            <p style="color: #888; font-size: 0.8rem; margin-bottom: 20px;">El c√≥digo se gener√≥ correctamente para <b><span id="target-alumno"></span></b>.</p>
            
            <label>Vista previa del c√≥digo:</label>
            <div id="linkFinal" class="copy-area" style="height: 60px; overflow-y: auto; opacity: 0.5; border-style: dashed; margin-bottom: 20px;"></div>
            
            <button onclick="copiarLink(event)" style="background: var(--primary); color: white; width:100%; padding:18px; border:none; border-radius:12px; font-weight:bold; cursor:pointer; font-size: 1rem; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);">
                üìã COPIAR C√ìDIGO PARA ENVIAR
            </button>
        </div>
        <textarea id="temp-copy" style="position: absolute; left: -9999px;"></textarea>
    </div>

    <footer class="footer-sign">
    DESARROLLADO POR <a href="https://www.linkedin.com/in/nicolas-yabichino/" target="_blank"><span>NICOYABI</span></a>
</footer>

<script>
    let contadorSesiones = 0;

    const DATA_EJERCICIOS = {
        "MOVILIDAD": ["Rotacion de columna", "Movilidad de cadera", "Movilidad de rodilla", "Rotacion de hombros", "Gato malo/bueno"],
        "ABDOMEN / CORE": ["Plancha frontal", "Plancha lateral", "Planchas din√°micas", "Crunch", "Oblicuos", "Bicho muerto", "Bird-dog", "Abs wheel (ruedita)", "Abs sovieticas", "Le√±ador ascendente", "Le√±ador descendente", "Elevacion de piernas"],
        "TREN INF / CUADRICEPS / GEMELOS": ["Sentadilla con barra alta", "Sentadilla con barra baja", "Sentadilla frontal", "Sentadilla en multipower", "Sentadilla hack", "Sentadilla pendular", "Sentadilla goblet", "Sentadilla bulgara (enfoque cuadriceps)", "Prensa bilateral / unilateral", "Sillon cuadriceps bilateral /unilateral", "Estocada hacia adelante", "Subidas al banco (enfoque cuadriceps)", "Gemelos en prensa", "Gemelos en maquina especifica", "Gemelos con mancuernas", "Gemelos con barra"],
        "TREN INF / ISQUIOS / GLUTEOS / ADUCTORES": ["Peso muerto convencional", "Peso muerto rumano", "Peso muerto piernas rigidas", "Peso muerto sumo", "Peso muerto unilateral", "Camilla de isquis bilateral / unilateral", "Aductores en maquina", "Abducciones en maquina", "Patada de gluteo en maquina especifica", "Patada de gluteo en polea", "Hip-trust bilateral / unilateral", "Sentadilla bulgara (enfoque gluteo)", "Subida al banco (enfoque gluteo)", "Abducciones con banda"],
        "PECTORAL": ["Press plano barra / mancuerna / multipower", "Press inclinado barra / mancuenra / multipower", "Press declinado con mancuerna", "Press en polea altura media", "Peck deck", "Apertura con mancuernas", "Flexiones de brazos", "Poleas cruzadas"],
        "DORSALES": ["Dominadas supina", "Dominadas pronacion", "Jalon al pecho supino", "Jalon al pecho prono", "Jalon al pecho agarre cerrado (triangulo)", "Remo bajo ancho", "Remo bajo cerrado", "Remo bajo unilateral", "Remo con mancuerna biilateral / unilateral", "Remo con barra codo abierto", "Remo con barra codo cerrado", "Pullover", "Remo dorian"],
        "BICEPS / TRICEPS / DELTOIDES": ["Curl biceps con barra", "Curl biceps con mancuerna", "Curl biceps sentado con mancuerna", "Curl bicepspredicador con barra", "Curl biceps predicador con mancuerna", "Curl biceps en polea", "Curl biceps bayessian", "Curl biceps martillo", "Triceps polea alta bilat / unilat", "Triceps trasnuca bilat / unilat", "Press frances", "Fondo en paralela", "Press vertical barra / mancuerna (deltoides)", "Vuelo lateral", "Vuelo frontal", "Vuelo posterior", "Peck deck inverso."]
    };
function agregarSesion() {
    contadorSesiones++;
    const div = document.createElement('div');
    div.className = 'card sesion';
    div.id = `sesion-${contadorSesiones}`;
    div.innerHTML = `
        <div class="dia-label">D√çA CONFIGURADO</div>
        <div style="display:flex; justify-content:space-between; margin-bottom:15px; align-items:center;">
            <input type="text" placeholder="Ej: Lunes" class="nombre-sesion" style="width:80%; margin:0; font-weight:bold;">
            <button style="background:var(--danger); border:none; color:white; padding:5px 10px; border-radius:5px;" onclick="this.parentElement.parentElement.remove()">X</button>
        </div>
        <div class="ejercicios-container"></div>
        <button class="btn-add-ex" onclick="agregarEjercicio(${contadorSesiones})">+ A√±adir Ejercicio</button>
    `;
    document.getElementById('rutina-container').appendChild(div);
    agregarEjercicio(contadorSesiones);
}

function agregarEjercicio(sId) {
    const container = document.querySelector(`#sesion-${sId} .ejercicios-container`);
    const div = document.createElement('div');
    div.className = 'ex-item';
    
    const gruposHtml = Object.keys(DATA_EJERCICIOS).map(g => `<option value="${g}">${g}</option>`).join('');
    
    div.innerHTML = `
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom:8px;">
            <div><label>Grupo</label><select class="ex-grupo" onchange="actualizarEjercicios(this)">${gruposHtml}</select></div>
            <div><label>Ejercicio</label><select class="ex-nombre"></select></div>
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin-bottom:8px;">
            <div><label>Sets</label><input type="number" class="ex-series" value="4"></div>
            <div><label>Rep (Obj)</label><input type="text" class="ex-reps" placeholder="12,10"></div>
            <div><label>Kg (Obj)</label><input type="text" class="ex-peso" placeholder="50,60"></div>
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
<div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
    <div>
        <label>Descanso entre Sets (seg)</label>
        <input type="number" class="ex-descanso" value="90" style="border: 1px solid var(--accent);">
    </div>
    <div>
        <label>Descanso al terminar Ej. (seg)</label>
        <input type="number" class="ex-descanso-final" value="120" style="border: 1px solid var(--electric-blue);">
    </div>
</div>
            <div><label>Link Video</label><input type="text" class="ex-video" placeholder="YouTube"></div>
        </div>
        <div style="margin-top:5px;">
            <label style="color:var(--electric-blue)">Indicaciones / Notas</label>
            <textarea class="ex-notas" placeholder="Ej: Pausa de 2 seg abajo..." style="width:100%; height:50px; background:#0d1117; color:white; border:1px solid #30363d; border-radius:8px; padding:8px; font-size:0.8rem;"></textarea>
        </div>
        <button onclick="this.parentElement.remove()" style="background:none; color:#da3633; border:none; font-size:0.7rem; cursor:pointer; width:100%; text-align:right; margin-top:5px;">Eliminar Ejercicio</button>
    `;
    container.appendChild(div);
    actualizarEjercicios(div.querySelector('.ex-grupo'));
}

    function actualizarEjercicios(selectGrupo) {
        const grupo = selectGrupo.value;
        const selectEx = selectGrupo.parentElement.parentElement.parentElement.querySelector('.ex-nombre');
        const ejercicios = DATA_EJERCICIOS[grupo] || [];
        selectEx.innerHTML = ejercicios.map(e => `<option value="${e}">${e}</option>`).join('');
    }

function generarLink() {
    const nombre = document.getElementById('alumno-nombre').value;
    const semana = document.getElementById('semana-nro').value;
    if(!nombre) return alert("Falta nombre del alumno");
    
    const rutina = { alumno: nombre, semana: semana, sesiones: {} };
    document.querySelectorAll('.sesion').forEach((s, idx) => {
        const ejercicios = [];
        s.querySelectorAll('.ex-item').forEach(item => {
            ejercicios.push({
                nombre: item.querySelector('.ex-nombre').value,
                grupo: item.querySelector('.ex-grupo').value,
                series: parseInt(item.querySelector('.ex-series').value),
                reps_obj: item.querySelector('.ex-reps').value,
                peso_obj: item.querySelector('.ex-peso').value,
                descanso: parseInt(item.querySelector('.ex-descanso').value) || 90,
                descanso_final: parseInt(item.querySelector('.ex-descanso-final').value) || 120, // Captura el individual
                video: item.querySelector('.ex-video').value,
                notas: item.querySelector('.ex-notas').value
            });
        });
        rutina.sesiones[idx + 1] = {
            nombre: s.querySelector('.nombre-sesion').value || `D√≠a ${idx+1}`,
            ejercicios: ejercicios
        };
    });

    const base64 = btoa(unescape(encodeURIComponent(JSON.stringify(rutina))));
    document.getElementById('target-alumno').innerText = nombre.toUpperCase();
    document.getElementById('linkFinal').innerText = base64;
    document.getElementById('resultado').style.display = "block";
    window.scrollTo({ top: document.getElementById('resultado').offsetTop - 20, behavior: 'smooth' });
}

function copiarLink(event) { // <--- Agregamos 'event' aqu√≠
    const text = document.getElementById("linkFinal").innerText;
    const tempInput = document.getElementById("temp-copy");
    tempInput.value = text;
    tempInput.select();
    document.execCommand("copy");
    
    // Feedback visual en el bot√≥n
    const btn = event.currentTarget;
    const originalText = btn.innerHTML;
    btn.style.background = "var(--success)";
    btn.innerHTML = "‚úÖ ¬°COPIADO CON √âXITO!";
    
    setTimeout(() => {
        btn.style.background = "var(--primary)";
        btn.innerHTML = originalText;
    }, 2000);
}

    // √öNICA ADICI√ìN EN SCRIPT: REGISTRO DEL SERVICE WORKER
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        // Al estar en la misma carpeta, la ruta es directa
        navigator.serviceWorker.register('./sw-admin.js')
            .then(reg => console.log('Admin SW OK'))
            .catch(err => console.log('Error:', err));
    });
}

    agregarSesion();
function verificarAcceso() {
    const pass = document.getElementById('admin-pass').value;
    
    // La clave "Rio2026" escondida en Base64
    const CLAVE_ESCONDIDA = "UmlvMjAyNg=="; 

    // Convertimos lo que ingres√≥ el usuario a Base64 para comparar
    const passCifrado = btoa(unescape(encodeURIComponent(pass)));

    if(passCifrado === CLAVE_ESCONDIDA) {
        document.getElementById('access-screen').style.display = 'none';
        sessionStorage.setItem('admin_auth', 'true');
    } else {
        document.getElementById('error-msg').style.display = 'block';
        document.getElementById('admin-pass').value = '';
    }
}

// Al cargar la p√°gina, si ya entr√≥ antes en esta sesi√≥n, ocultamos el bloqueo
window.addEventListener('DOMContentLoaded', () => {
    if(sessionStorage.getItem('admin_auth') === 'true') {
        document.getElementById('access-screen').style.display = 'none';
    }
});
function importarRutina() {
    let codigo = prompt("Pega aqu√≠ el c√≥digo Base64 de la rutina:");
    if (!codigo) return;

    try {
        // LIMPIEZA: Quitamos espacios, saltos de l√≠nea y tabulaciones que el celular suele meter
        codigo = codigo.trim().replace(/\s/g, '');

        // Decodificamos con manejo de caracteres especiales
        const data = JSON.parse(decodeURIComponent(escape(atob(codigo))));
        
        // 1. Limpiar el contenedor actual
        document.getElementById('rutina-container').innerHTML = "";
        contadorSesiones = 0;

        // 2. Cargar datos generales
        document.getElementById('alumno-nombre').value = data.alumno || "";
        document.getElementById('semana-nro').value = data.semana || "";

        // 3. Reconstruir cada Sesi√≥n
        Object.keys(data.sesiones).forEach(sKey => {
            const s = data.sesiones[sKey];
            agregarSesion(); 
            
            const sesionDiv = document.getElementById(`sesion-${contadorSesiones}`);
            sesionDiv.querySelector('.nombre-sesion').value = s.nombre;
            sesionDiv.querySelector('.ejercicios-container').innerHTML = "";

            s.ejercicios.forEach(ex => {
                agregarEjercicio(contadorSesiones);
                const exItems = sesionDiv.querySelectorAll('.ex-item');
                const lastEx = exItems[exItems.length - 1];

                lastEx.querySelector('.ex-grupo').value = ex.grupo;
                actualizarEjercicios(lastEx.querySelector('.ex-grupo')); 
                
                lastEx.querySelector('.ex-nombre').value = ex.nombre;
                lastEx.querySelector('.ex-series').value = ex.series;
                lastEx.querySelector('.ex-reps').value = ex.reps_obj;
                lastEx.querySelector('.ex-peso').value = ex.peso_obj;
                lastEx.querySelector('.ex-descanso').value = ex.descanso || 90;
                
                if(lastEx.querySelector('.ex-descanso-final')) {
                    lastEx.querySelector('.ex-descanso-final').value = ex.descanso_final || 120;
                }
                
                lastEx.querySelector('.ex-video').value = ex.video || "";
                lastEx.querySelector('.ex-notas').value = ex.notas || "";
            });
        });
        
        alert("¬°Rutina importada con √©xito!");
        
    } catch (e) {
        alert("Error: El c√≥digo pegado no es v√°lido. Aseg√∫rate de copiarlo completo.");
        console.error("Error al decodificar:", e);
    }
}
</script>
</body>
</html>

